<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; img-src 'self' data: https: http: blob:; font-src 'self' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; connect-src 'self' http://localhost:5000 https: http:; object-src 'none'; base-uri 'self'; frame-ancestors 'none';">
    
    <!-- SEO Meta Tags -->
    <title>Search Results - Golden Source Technologies | Nairobi, Kenya</title>
    <meta name="description" content="Search for electronics products. Find laptops, phones, cameras, audio equipment, and more. Best prices, genuine products, fast delivery in Nairobi, Kenya.">
    <meta name="robots" content="noindex, follow">
    <link rel="canonical" href="https://goldensourcetech.co.ke/search">
    <link rel="icon" type="image/png" href="/images/favicon.png">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous">
    <link href="css/style.css" rel="stylesheet">
    <link rel="stylesheet" href="css/mobile-home.css?v=1" media="(max-width: 991px)">
    <style>
        /* Desktop visible by default */
        .desktop-shell {
            display: block;
        }
        .mobile-shell {
            display: none;
        }
        @media (max-width: 991px) {
            .desktop-shell {
                display: none !important;
            }
            .mobile-shell {
                display: block !important;
            }
        }
    </style>
    <style>
        .search-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 3rem 0;
            margin-bottom: 2rem;
        }
        .search-box {
            background: white;
            border-radius: 50px;
            padding: 0.5rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .search-input {
            border: none;
            outline: none;
            padding: 0.75rem 1rem;
            border-radius: 50px;
            width: 100%;
            font-size: 1.1rem;
        }
        .search-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 0.75rem 2rem;
            border-radius: 50px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        .search-filters {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            margin-bottom: 2rem;
        }
        .filter-group {
            margin-bottom: 1rem;
        }
        .filter-label {
            font-weight: 600;
            color: #333;
            margin-bottom: 0.5rem;
        }
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding: 1rem 0;
            border-bottom: 2px solid #f8f9fa;
        }
        .results-count {
            font-size: 1.1rem;
            color: #666;
        }
        .sort-select {
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 0.5rem 1rem;
            background: white;
        }
        .no-results {
            text-align: center;
            padding: 4rem 2rem;
            color: #666;
        }
        .no-results i {
            font-size: 4rem;
            color: #ddd;
            margin-bottom: 1rem;
        }
        .search-suggestions {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1rem;
            margin-top: 1rem;
        }
        .suggestion-item {
            display: inline-block;
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 20px;
            padding: 0.5rem 1rem;
            margin: 0.25rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .suggestion-item:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
    </style>
</head>
<body>
<!-- Desktop Layout -->
<div class="desktop-shell">
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
        <div class="container">
            <a class="navbar-brand fw-bold text-primary" href="/">
                <i class="fas fa-laptop me-2"></i>Golden Source Technologies
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/laptops">Laptops</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/phones">Phones</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/cameras">Cameras</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/accessories">Accessories</a>
                    </li>
                </ul>
                <div class="d-flex">
                    <a href="/cart" class="btn btn-outline-primary me-2">
                        <i class="fas fa-shopping-cart"></i> Cart
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Search Container -->
    <div class="search-container">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <h1 class="text-center mb-4">
                        <i class="fas fa-search me-2"></i>Search Products
                    </h1>
                    <div class="search-box">
                        <form id="searchForm" class="d-flex">
                            <input type="text" id="searchInput" class="search-input" placeholder="Search for products, brands, categories..." value="">
                            <button type="submit" class="btn search-btn">
                                <i class="fas fa-search me-2"></i>Search
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Search Filters -->
        <div class="search-filters">
            <div class="row">
                <div class="col-md-3">
                    <div class="filter-group">
                        <label class="filter-label">Category</label>
                        <select id="categoryFilter" class="form-select">
                            <option value="">All Categories</option>
                            <option value="laptops">Laptops</option>
                            <option value="phones">Phones</option>
                            <option value="cameras">Cameras</option>
                            <option value="accessories">Accessories</option>
                            <option value="audio">Audio</option>
                            <option value="smart-home">Smart Home</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="filter-group">
                        <label class="filter-label">Brand</label>
                        <select id="brandFilter" class="form-select">
                            <option value="">All Brands</option>
                            <option value="Apple">Apple</option>
                            <option value="Samsung">Samsung</option>
                            <option value="Dell">Dell</option>
                            <option value="HP">HP</option>
                            <option value="Lenovo">Lenovo</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="filter-group">
                        <label class="filter-label">Min Price</label>
                        <input type="number" id="minPrice" class="form-control" placeholder="0">
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="filter-group">
                        <label class="filter-label">Max Price</label>
                        <input type="number" id="maxPrice" class="form-control" placeholder="1000000">
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Header -->
        <div class="results-header">
            <div class="results-count">
                <span id="resultsCount">0</span> products found for "<span id="searchQuery"></span>"
            </div>
            <div>
                <select id="sortSelect" class="sort-select">
                    <option value="relevance">Sort by Relevance</option>
                    <option value="name">Sort by Name</option>
                    <option value="price-low">Price: Low to High</option>
                    <option value="price-high">Price: High to Low</option>
                    <option value="newest">Newest First</option>
                </select>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loadingState" class="text-center py-5" style="display: none;">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-3">Searching products...</p>
        </div>

        <!-- No Results State -->
        <div id="noResultsState" class="no-results" style="display: none;">
            <i class="fas fa-search"></i>
            <h3>No products found</h3>
            <p>Try adjusting your search terms or filters</p>
            <div class="search-suggestions">
                <h6>Popular searches:</h6>
                <span class="suggestion-item" onclick="searchFor('laptop')">laptop</span>
                <span class="suggestion-item" onclick="searchFor('iPhone')">iPhone</span>
                <span class="suggestion-item" onclick="searchFor('camera')">camera</span>
                <span class="suggestion-item" onclick="searchFor('headphones')">headphones</span>
            </div>
        </div>

        <!-- Search Results -->
        <div id="searchResults" class="row">
            <!-- Results will be populated here -->
        </div>
    </div>
</div> <!-- End desktop-shell -->

<!-- Mobile Layout -->
<div class="mobile-shell">
    <!-- Scrolling Logo Header -->
    <div class="mobile-logo-header" id="mobileLogoHeader">
        <div class="mobile-logo-brand">
            <img src="images/logo.png" alt="Golden Source Technologies" class="mobile-logo-img">
            <span class="mobile-brand-name">Golden Source Technologies</span>
        </div>
    </div>

    <header class="mobile-icon-header">
        <div class="icon-group">
            <button class="mobile-icon-btn" id="mobileMenuToggle" aria-label="Open menu">
                <i class="fa-solid fa-bars"></i>
            </button>
        </div>
        <div class="icon-group">
            <button class="mobile-icon-btn" id="mobileSearchToggle" aria-label="Search">
                <i class="fa-solid fa-magnifying-glass"></i>
            </button>
            <a href="/cart" class="mobile-icon-btn" aria-label="Cart">
                <i class="fa-solid fa-cart-shopping"></i>
                <span class="cart-count-badge" id="mobileCartBadge" style="display:none;">0</span>
            </a>
        </div>
    </header>
    
    <!-- Menu Overlay -->
    <div class="mobile-menu-overlay" id="mobileMenuOverlay"></div>
    
    <!-- Menu Drawer -->
    <nav class="mobile-menu-drawer" id="mobileMenuDrawer">
        <div class="mobile-menu-header">
            <h3>Menu</h3>
            <button class="mobile-icon-btn" id="mobileMenuClose" aria-label="Close menu">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="mobile-menu-links">
            <a href="/">Home</a>
            <a href="/laptops">Laptops</a>
            <a href="/phones">Phones</a>
            <a href="/cameras">Cameras</a>
            <a href="/audio">Audio &amp; Headphones</a>
            <a href="/accessories">Accessories</a>
            <a href="/smart-home">Smart Home</a>
            <a href="/deals">Deals</a>
        </div>
    </nav>
    
    <!-- Search Overlay -->
    <div class="mobile-search-overlay" id="mobileSearchOverlay"></div>
    
    <!-- Search Panel -->
    <div class="mobile-search-panel" id="mobileSearchPanel">
        <form class="mobile-search-form" id="mobileSearchForm">
            <input 
                type="search" 
                class="mobile-search-input" 
                id="mobileSearchInput"
                placeholder="Search products..."
                autocomplete="off"
            >
            <button type="button" class="mobile-icon-btn" id="mobileSearchClose" aria-label="Close search">
                <i class="fas fa-times"></i>
            </button>
        </form>
    </div>

    <main class="mobile-category">
        <section class="category-hero">
            <p class="eyebrow">Search results</p>
            <h1 id="mobileSearchTitle">Find what you need</h1>
            <p class="hero-copy" id="mobileSearchSubtitle">
                Search for products, brands, or categories.
            </p>
        </section>

        <section class="mobile-products">
            <div class="card-grid" id="mobileSearchResults" data-products-container>
                <div class="loading-state">
                    <i class="fas fa-spinner fa-spin"></i>
                    <span>Searching...</span>
                </div>
            </div>
        </section>
    </main>

    <footer class="mobile-footer">
        <div class="footer-brand">
            <img src="images/logo.png" alt="Golden Source logo">
            <p>Your trusted partner for cameras, computers, and smart living essentials.</p>
        </div>
        <div class="footer-links">
            <h4>Shop</h4>
            <a href="/laptops">Laptops</a>
            <a href="/phones">Phones</a>
            <a href="/cameras">Cameras</a>
            <a href="/deals">Deals</a>
        </div>
        <div class="footer-links">
            <h4>Support</h4>
            <a href="mailto:support@goldensource.com">support@goldensource.com</a>
            <a href="tel:+254724369971">+254 724 369 971</a>
            <span>Nairobi, Kenya</span>
        </div>
    </footer>
</div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/api.js"></script>
    <script src="js/cart.js"></script>
    <script src="js/sticky-nav.js"></script>
    <script>
        // Global variables
        const FILTER_STORAGE_KEY = 'gst-search-filters';
        let currentSearchTerm = '';
        let currentFilters = {
            category: '',
            brand: '',
            minPrice: '',
            maxPrice: ''
        };

        // Initialize search page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üîç Initializing search page');
            
            // Get search term from URL
            const urlParams = new URLSearchParams(window.location.search);
            const searchTerm = urlParams.get('q');
            
            if (searchTerm) {
                document.getElementById('searchInput').value = searchTerm;
                currentSearchTerm = searchTerm;
                performSearch();
            }
            
            const savedFilters = loadPersistedFilters();
            if (savedFilters) {
                if (savedFilters.category) {
                    document.getElementById('categoryFilter').value = savedFilters.category;
                    currentFilters.category = savedFilters.category;
                }
                if (savedFilters.brand) {
                    document.getElementById('brandFilter').value = savedFilters.brand;
                    currentFilters.brand = savedFilters.brand;
                }
                if (savedFilters.minPrice) {
                    document.getElementById('minPrice').value = savedFilters.minPrice;
                    currentFilters.minPrice = savedFilters.minPrice;
                }
                if (savedFilters.maxPrice) {
                    document.getElementById('maxPrice').value = savedFilters.maxPrice;
                    currentFilters.maxPrice = savedFilters.maxPrice;
                }
                if (savedFilters.sort) {
                    document.getElementById('sortSelect').value = savedFilters.sort;
                }
            }

            setupEventListeners();
        });

        // Setup event listeners
        function setupEventListeners() {
            // Search form
            document.getElementById('searchForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const searchTerm = document.getElementById('searchInput').value.trim();
                if (searchTerm) {
                    currentSearchTerm = searchTerm;
                    updateURL(searchTerm);
                    performSearch();
                }
            });

            // Filter changes
            document.getElementById('categoryFilter').addEventListener('change', function() {
                currentFilters.category = this.value;
                persistFilters();
                performSearch();
            });

            document.getElementById('brandFilter').addEventListener('change', function() {
                currentFilters.brand = this.value;
                persistFilters();
                performSearch();
            });

            document.getElementById('minPrice').addEventListener('input', function() {
                currentFilters.minPrice = this.value;
                persistFilters();
                performSearch();
            });

            document.getElementById('maxPrice').addEventListener('input', function() {
                currentFilters.maxPrice = this.value;
                persistFilters();
                performSearch();
            });

            // Sort change
            document.getElementById('sortSelect').addEventListener('change', function() {
                persistFilters();
                performSearch();
            });
        }

        // Perform search
        async function performSearch() {
            if (!currentSearchTerm) {
                showNoResults();
                return;
            }

            showLoading();
            
            try {
                const params = new URLSearchParams({
                    q: currentSearchTerm,
                    limit: 50
                });

                // Add filters
                if (currentFilters.category) params.append('category', currentFilters.category);
                if (currentFilters.brand) params.append('brand', currentFilters.brand);
                if (currentFilters.minPrice) params.append('minPrice', currentFilters.minPrice);
                if (currentFilters.maxPrice) params.append('maxPrice', currentFilters.maxPrice);

                const response = await fetch(`/api/search?${params}`);
                const data = await response.json();

                if (data.success) {
                    displayResults(data.data.products, data.data.query);
                    persistFilters();
                    if (window.searchEnhancements && typeof window.searchEnhancements.recordSearchTerm === 'function') {
                        window.searchEnhancements.recordSearchTerm(currentSearchTerm);
                    }
                } else {
                    showError('Search failed. Please try again.');
                }
            } catch (error) {
                console.error('Search error:', error);
                showError('Search failed. Please check your connection.');
            }
        }

        // Display search results
        function displayResults(products, query) {
            hideLoading();
            
            document.getElementById('searchQuery').textContent = query;
            document.getElementById('resultsCount').textContent = products.length;

            if (products.length === 0) {
                showNoResults();
                return;
            }

            const sortedProducts = applySort(products);
            const container = document.getElementById('searchResults');
            container.innerHTML = '';

            sortedProducts.forEach(product => {
                const productCard = createProductCard(product);
                container.appendChild(productCard);
            });
        }

        function applySort(products) {
            const sortValue = document.getElementById('sortSelect').value;
            const list = [...products];

            switch (sortValue) {
                case 'name':
                    return list.sort((a, b) => a.name.localeCompare(b.name));
                case 'price-low':
                    return list.sort((a, b) => Number(a.price || 0) - Number(b.price || 0));
                case 'price-high':
                    return list.sort((a, b) => Number(b.price || 0) - Number(a.price || 0));
                case 'newest':
                    return list.sort((a, b) => {
                        const aDate = new Date(a.createdAt || 0);
                        const bDate = new Date(b.createdAt || 0);
                        return bDate - aDate;
                    });
                default:
                    return list;
            }
        }

        // Create product card
        function createProductCard(product) {
            const col = document.createElement('div');
            col.className = 'col-md-4 col-lg-3 mb-4';
            
            const img = (product.images && product.images[0] && product.images[0].url) ? product.images[0].url : '/images/default.jpg';
            const original = product.originalPrice ? `<span class="original-price">KSh ${Number(product.originalPrice).toLocaleString()}</span>` : '';
            const pid = product._id || product.id;
            
            // Calculate discount percentage
            let discountBadge = '';
            if (product.originalPrice && product.originalPrice > product.price) {
                const discount = Math.round(((product.originalPrice - product.price) / product.originalPrice) * 100);
                discountBadge = `<div class="discount-badge">-${discount}%</div>`;
            }

            col.innerHTML = `
                <div class="product-item clickable-card" data-product-id="${pid}" onclick="viewProduct('${pid}')">
                    <div class="product-image">
                        <img src="${img}" alt="${product.name}" class="product-img" onerror="this.onerror=null;this.src='/images/default.jpg';">
                        ${discountBadge}
                    </div>
                    <div class="product-info">
                        <h3>${product.name}</h3>
                        <div class="product-price">
                            <span class="current-price">KSh ${Number(product.price).toLocaleString()}</span>
                            ${original}
                        </div>
                        <div class="product-actions">
                            <button class="btn btn-primary home-add-cart-btn" onclick="event.stopPropagation(); event.preventDefault(); addToCart('${pid}', '${product.name.replace(/'/g, '\\\'').replace(/"/g, '\\"')}', ${product.price}, '${img.replace(/'/g, '\\\'').replace(/"/g, '\\"')}')">Add to Cart</button>
                        </div>
                    </div>
                </div>
            `;

            return col;
        }

        // Show loading state
        function showLoading() {
            document.getElementById('loadingState').style.display = 'block';
            document.getElementById('noResultsState').style.display = 'none';
            document.getElementById('searchResults').innerHTML = '';
        }

        // Hide loading state
        function hideLoading() {
            document.getElementById('loadingState').style.display = 'none';
        }

        // Show no results
        function showNoResults() {
            hideLoading();
            document.getElementById('noResultsState').style.display = 'block';
            document.getElementById('searchResults').innerHTML = '';
            document.getElementById('resultsCount').textContent = '0';
        }

        // Show error
        function showError(message) {
            hideLoading();
            document.getElementById('searchResults').innerHTML = `
                <div class="col-12">
                    <div class="alert alert-danger text-center">
                        <i class="fas fa-exclamation-triangle me-2"></i>${message}
                    </div>
                </div>
            `;
        }

        // Update URL
        function updateURL(searchTerm) {
            const url = new URL(window.location);
            url.searchParams.set('q', searchTerm);
            window.history.pushState({}, '', url);
        }

        function persistFilters() {
            const payload = {
                ...currentFilters,
                sort: document.getElementById('sortSelect').value
            };
            try {
                localStorage.setItem(FILTER_STORAGE_KEY, JSON.stringify(payload));
            } catch (error) {
                console.warn('Unable to persist filters', error);
            }
        }

        function loadPersistedFilters() {
            try {
                const stored = localStorage.getItem(FILTER_STORAGE_KEY);
                return stored ? JSON.parse(stored) : null;
            } catch (error) {
                console.warn('Unable to read stored filters', error);
                return null;
            }
        }

        // Search for suggestion
        function searchFor(term) {
            document.getElementById('searchInput').value = term;
            currentSearchTerm = term;
            if (window.searchEnhancements && typeof window.searchEnhancements.recordSearchTerm === 'function') {
                window.searchEnhancements.recordSearchTerm(term);
            }
            updateURL(term);
            performSearch();
        }

        // View product function
        function viewProduct(productId) {
            console.log('üîç Viewing product:', productId);
            window.location.href = `/product?id=${productId}`;
        }

        // Make functions globally accessible
        window.viewProduct = viewProduct;
        window.searchFor = searchFor;
    </script>
    <script src="js/mobile-home.js"></script>
</body>
</html>

